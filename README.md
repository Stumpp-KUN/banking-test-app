README
## Описание проекта

Это Spring Boot приложение для управления пользователями, их контактами (email и телефоны) и банковскими операциями. Основные функции включают:

- Управление пользователями и их контактами
- Банковские операции (переводы между счетами)
- Автоматическое начисление процентов на баланс
- JWT аутентификация
- Кэширование для повышения производительности

## Технологии

- **Java 21**
- **Spring Boot 3.x**
- **PostgreSQL** - основная база данных
- **Liquibase** - для управления миграциями базы данных
- **JWT** - для аутентификации
- **Caffeine** - для кэширования
- **Swagger** - для документации API
- **Testcontainers** - для интеграционного тестирования
- **Maven** - для сборки проекта

## Особенности реализации

1. Добавлена таблица `transfers` для хранения истории всех переводов между счетами с поддержкой различных статусов (PENDING, COMPLETED, FAILED, REVERSED)
2. Реализована потокобезопасная обработка переводов с использованием пессимистичных блокировок
3. Добавлены ограничения на максимальную сумму перевода (1,000,000 рублей)
4. Реализовано автоматическое начисление 10% на баланс каждые 30 секунд (но не более 207% от начального депозита)
5. Подробное логирование всех операций
6. Полноценная валидация всех входящих данных

## Запуск проекта

### Требования

- Docker и Docker Compose
- Java 17 (только для локальной разработки)

### Запуск через Docker Compose

1. Склонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd <project-directory>
   ```

2. Запустите приложение:
   ```bash
   docker-compose up -d
   ```

Приложение будет доступно по адресу: `http://localhost:8080`

### Локальный запуск (для разработки)

1. Убедитесь, что у вас установлены:
   - Java 17
   - PostgreSQL (или используйте тестовый контейнер)

2. Настройте подключение к базе данных в `application.yml`

3. Запустите приложение:
   ```bash
   mvn spring-boot:run
   ```

## API Документация

После запуска приложения документация API доступна по адресу:
- Swagger UI: `http://localhost:8080/swagger-ui.html`
- OpenAPI спецификация: `http://localhost:8080/v3/api-docs`

## Миграции базы данных

Миграции выполняются автоматически при старте приложения с помощью Liquibase. Все миграции находятся в `src/main/resources/db/changelog`.

## Тестирование

Для запуска тестов:
```bash
mvn test
```

Проект включает:
- Unit тесты для сервисов
- Интеграционные тесты с использованием Testcontainers
- Тесты для API с помощью MockMvc

## Логирование

Настроено детальное логирование для:
- Всех операций с балансом
- Операций перевода денег
- Изменений контактных данных пользователей
- Ошибок валидации

Логи можно найти в стандартном выводе или в файле `logs/application.log` (при настройке файлового логгера).

## Примеры запросов

### Аутентификация
```bash
curl -X POST "http://localhost:8080/api/auth/login" \
-H "Content-Type: application/json" \
-d '{"email":"user@example.com", "password":"securepassword"}'
```

### Получение информации о пользователе
```bash
curl -X GET "http://localhost:8080/api/users/1" \
-H "Authorization: Bearer <JWT_TOKEN>"
```

### Перевод денег
```bash
curl -X POST "http://localhost:8080/api/transfers" \
-H "Authorization: Bearer <JWT_TOKEN>" \
-H "Content-Type: application/json" \
-d '{"toUserId": 2, "amount": 100.50}'
```

## Структура базы данных

Основные таблицы:
- `users` - информация о пользователях
- `account` - банковские счета пользователей
- `email_data` - email адреса пользователей
- `phone_data` - телефонные номера пользователей
- `transfers` - история всех переводов между счетами

